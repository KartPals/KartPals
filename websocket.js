var ke=Object.create;var re=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var se=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var Se=(n,e)=>()=>(n&&(e=n(n=0)),e);var S=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Me=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of Ae(e))!Le.call(n,u)&&u!==t&&re(n,u,{get:()=>e[u],enumerable:!(s=Ie(e,u))||s.enumerable});return n};var j=(n,e,t)=>(t=n!=null?ke(Pe(n)):{},Me(e||!n||!n.__esModule?re(t,"default",{value:n,enumerable:!0}):t,n));var F=Se(()=>{});var ie=S((Ke,oe)=>{F();var H=1e3,O=H*60,z=O*60,M=z*24,He=M*7,Oe=M*365.25;oe.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return ze(n);if(t==="number"&&isFinite(n))return e.long?qe(n):Re(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function ze(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*Oe;case"weeks":case"week":case"w":return t*He;case"days":case"day":case"d":return t*M;case"hours":case"hour":case"hrs":case"hr":case"h":return t*z;case"minutes":case"minute":case"mins":case"min":case"m":return t*O;case"seconds":case"second":case"secs":case"sec":case"s":return t*H;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Re(n){var e=Math.abs(n);return e>=M?Math.round(n/M)+"d":e>=z?Math.round(n/z)+"h":e>=O?Math.round(n/O)+"m":e>=H?Math.round(n/H)+"s":n+"ms"}function qe(n){var e=Math.abs(n);return e>=M?U(n,e,M,"day"):e>=z?U(n,e,z,"hour"):e>=O?U(n,e,O,"minute"):e>=H?U(n,e,H,"second"):n+" ms"}function U(n,e,t,s){var u=e>=t*1.5;return Math.round(n/t)+" "+s+(u?"s":"")}});var ce=S((Xe,ae)=>{F();function We(n){t.debug=t,t.default=t,t.coerce=a,t.disable=h,t.enable=u,t.enabled=C,t.humanize=ie(),t.destroy=g,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let o=0;for(let f=0;f<l.length;f++)o=(o<<5)-o+l.charCodeAt(f),o|=0;return t.colors[Math.abs(o)%t.colors.length]}t.selectColor=e;function t(l){let o,f=null,c,v;function w(..._){if(!w.enabled)return;let r=w,i=Number(new Date),y=i-(o||i);r.diff=y,r.prev=o,r.curr=i,o=i,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let p=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(m,L)=>{if(m==="%%")return"%";p++;let B=t.formatters[L];if(typeof B=="function"){let A=_[p];m=B.call(r,A),_.splice(p,1),p--}return m}),t.formatArgs.call(r,_),(r.log||t.log).apply(r,_)}return w.namespace=l,w.useColors=t.useColors(),w.color=t.selectColor(l),w.extend=s,w.destroy=t.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(c!==t.namespaces&&(c=t.namespaces,v=t.enabled(l)),v),set:_=>{f=_}}),typeof t.init=="function"&&t.init(w),w}function s(l,o){let f=t(this.namespace+(typeof o>"u"?":":o)+l);return f.log=this.log,f}function u(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let o=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let f of o)f[0]==="-"?t.skips.push(f.slice(1)):t.names.push(f)}function d(l,o){let f=0,c=0,v=-1,w=0;for(;f<l.length;)if(c<o.length&&(o[c]===l[f]||o[c]==="*"))o[c]==="*"?(v=c,w=f,c++):(f++,c++);else if(v!==-1)c=v+1,w++,f=w;else return!1;for(;c<o.length&&o[c]==="*";)c++;return c===o.length}function h(){let l=[...t.names,...t.skips.map(o=>"-"+o)].join(",");return t.enable(""),l}function C(l){for(let o of t.skips)if(d(l,o))return!1;for(let o of t.names)if(d(l,o))return!0;return!1}function a(l){return l instanceof Error?l.stack||l.message:l}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ae.exports=We});var fe=S((I,$)=>{F();I.formatArgs=De;I.save=Ee;I.load=je;I.useColors=Ne;I.storage=Ue();I.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();I.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ne(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function De(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+$.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,s=0;n[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(t++,u==="%c"&&(s=t))}),n.splice(s,0,e)}I.log=console.debug||console.log||(()=>{});function Ee(n){try{n?I.storage.setItem("debug",n):I.storage.removeItem("debug")}catch{}}function je(){let n;try{n=I.storage.getItem("debug")||I.storage.getItem("DEBUG")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Ue(){try{return localStorage}catch{}}$.exports=ce()(I);var{formatters:$e}=$.exports;$e.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ue=S((tt,Q)=>{"use strict";F();var Te=Object.prototype.hasOwnProperty,k="~";function N(){}Object.create&&(N.prototype=Object.create(null),new N().__proto__||(k=!1));function Je(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function le(n,e,t,s,u){if(typeof t!="function")throw new TypeError("The listener must be a function");var d=new Je(t,s||n,u),h=k?k+e:e;return n._events[h]?n._events[h].fn?n._events[h]=[n._events[h],d]:n._events[h].push(d):(n._events[h]=d,n._eventsCount++),n}function T(n,e){--n._eventsCount===0?n._events=new N:delete n._events[e]}function x(){this._events=new N,this._eventsCount=0}x.prototype.eventNames=function(){var e=[],t,s;if(this._eventsCount===0)return e;for(s in t=this._events)Te.call(t,s)&&e.push(k?s.slice(1):s);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};x.prototype.listeners=function(e){var t=k?k+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var u=0,d=s.length,h=new Array(d);u<d;u++)h[u]=s[u].fn;return h};x.prototype.listenerCount=function(e){var t=k?k+e:e,s=this._events[t];return s?s.fn?1:s.length:0};x.prototype.emit=function(e,t,s,u,d,h){var C=k?k+e:e;if(!this._events[C])return!1;var a=this._events[C],g=arguments.length,l,o;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),g){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,s),!0;case 4:return a.fn.call(a.context,t,s,u),!0;case 5:return a.fn.call(a.context,t,s,u,d),!0;case 6:return a.fn.call(a.context,t,s,u,d,h),!0}for(o=1,l=new Array(g-1);o<g;o++)l[o-1]=arguments[o];a.fn.apply(a.context,l)}else{var f=a.length,c;for(o=0;o<f;o++)switch(a[o].once&&this.removeListener(e,a[o].fn,void 0,!0),g){case 1:a[o].fn.call(a[o].context);break;case 2:a[o].fn.call(a[o].context,t);break;case 3:a[o].fn.call(a[o].context,t,s);break;case 4:a[o].fn.call(a[o].context,t,s,u);break;default:if(!l)for(c=1,l=new Array(g-1);c<g;c++)l[c-1]=arguments[c];a[o].fn.apply(a[o].context,l)}}return!0};x.prototype.on=function(e,t,s){return le(this,e,t,s,!1)};x.prototype.once=function(e,t,s){return le(this,e,t,s,!0)};x.prototype.removeListener=function(e,t,s,u){var d=k?k+e:e;if(!this._events[d])return this;if(!t)return T(this,d),this;var h=this._events[d];if(h.fn)h.fn===t&&(!u||h.once)&&(!s||h.context===s)&&T(this,d);else{for(var C=0,a=[],g=h.length;C<g;C++)(h[C].fn!==t||u&&!h[C].once||s&&h[C].context!==s)&&a.push(h[C]);a.length?this._events[d]=a.length===1?a[0]:a:T(this,d)}return this};x.prototype.removeAllListeners=function(e){var t;return e?(t=k?k+e:e,this._events[t]&&T(this,t)):(this._events=new N,this._eventsCount=0),this};x.prototype.off=x.prototype.removeListener;x.prototype.addListener=x.prototype.on;x.prefixed=k;x.EventEmitter=x;typeof Q<"u"&&(Q.exports=x)});var he=S((at,de)=>{F();de.exports={}});var Y=S((V,ve)=>{F();(function(n,e){typeof V=="object"?ve.exports=V=e():typeof define=="function"&&define.amd?define([],e):n.CryptoJS=e()})(V,function(){var n=n||function(e,t){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof se=="function")try{s=he()}catch{}var u=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},d=Object.create||function(){function r(){}return function(i){var y;return r.prototype=i,y=new r,r.prototype=null,y}}(),h={},C=h.lib={},a=C.Base=function(){return{extend:function(r){var i=d(this);return r&&i.mixIn(r),(!i.hasOwnProperty("init")||this.init===i.init)&&(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=C.WordArray=a.extend({init:function(r,i){r=this.words=r||[],i!=t?this.sigBytes=i:this.sigBytes=r.length*4},toString:function(r){return(r||o).stringify(this)},concat:function(r){var i=this.words,y=r.words,p=this.sigBytes,b=r.sigBytes;if(this.clamp(),p%4)for(var m=0;m<b;m++){var L=y[m>>>2]>>>24-m%4*8&255;i[p+m>>>2]|=L<<24-(p+m)%4*8}else for(var B=0;B<b;B+=4)i[p+B>>>2]=y[B>>>2];return this.sigBytes+=b,this},clamp:function(){var r=this.words,i=this.sigBytes;r[i>>>2]&=4294967295<<32-i%4*8,r.length=e.ceil(i/4)},clone:function(){var r=a.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var i=[],y=0;y<r;y+=4)i.push(u());return new g.init(i,r)}}),l=h.enc={},o=l.Hex={stringify:function(r){for(var i=r.words,y=r.sigBytes,p=[],b=0;b<y;b++){var m=i[b>>>2]>>>24-b%4*8&255;p.push((m>>>4).toString(16)),p.push((m&15).toString(16))}return p.join("")},parse:function(r){for(var i=r.length,y=[],p=0;p<i;p+=2)y[p>>>3]|=parseInt(r.substr(p,2),16)<<24-p%8*4;return new g.init(y,i/2)}},f=l.Latin1={stringify:function(r){for(var i=r.words,y=r.sigBytes,p=[],b=0;b<y;b++){var m=i[b>>>2]>>>24-b%4*8&255;p.push(String.fromCharCode(m))}return p.join("")},parse:function(r){for(var i=r.length,y=[],p=0;p<i;p++)y[p>>>2]|=(r.charCodeAt(p)&255)<<24-p%4*8;return new g.init(y,i)}},c=l.Utf8={stringify:function(r){try{return decodeURIComponent(escape(f.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return f.parse(unescape(encodeURIComponent(r)))}},v=C.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=c.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var i,y=this._data,p=y.words,b=y.sigBytes,m=this.blockSize,L=m*4,B=b/L;r?B=e.ceil(B):B=e.max((B|0)-this._minBufferSize,0);var A=B*m,E=e.min(A*4,b);if(A){for(var W=0;W<A;W+=m)this._doProcessBlock(p,W);i=p.splice(0,A),y.sigBytes-=E}return new g.init(i,E)},clone:function(){var r=a.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0}),w=C.Hasher=v.extend({cfg:a.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var i=this._doFinalize();return i},blockSize:512/32,_createHelper:function(r){return function(i,y){return new r.init(y).finalize(i)}},_createHmacHelper:function(r){return function(i,y){return new _.HMAC.init(r,y).finalize(i)}}}),_=h.algo={};return h}(Math);return n})});var Ce=S((G,pe)=>{F();(function(n,e){typeof G=="object"?pe.exports=G=e(Y()):typeof define=="function"&&define.amd?define(["./core"],e):e(n.CryptoJS)})(G,function(n){return function(e){var t=n,s=t.lib,u=s.WordArray,d=s.Hasher,h=t.algo,C=[],a=[];(function(){function o(w){for(var _=e.sqrt(w),r=2;r<=_;r++)if(!(w%r))return!1;return!0}function f(w){return(w-(w|0))*4294967296|0}for(var c=2,v=0;v<64;)o(c)&&(v<8&&(C[v]=f(e.pow(c,1/2))),a[v]=f(e.pow(c,1/3)),v++),c++})();var g=[],l=h.SHA256=d.extend({_doReset:function(){this._hash=new u.init(C.slice(0))},_doProcessBlock:function(o,f){for(var c=this._hash.words,v=c[0],w=c[1],_=c[2],r=c[3],i=c[4],y=c[5],p=c[6],b=c[7],m=0;m<64;m++){if(m<16)g[m]=o[f+m]|0;else{var L=g[m-15],B=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,A=g[m-2],E=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;g[m]=B+g[m-7]+E+g[m-16]}var W=i&y^~i&p,_e=v&w^v&_^w&_,be=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),xe=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),ne=b+xe+W+a[m]+g[m],Be=be+_e;b=p,p=y,y=i,i=r+ne|0,r=_,_=w,w=v,v=ne+Be|0}c[0]=c[0]+v|0,c[1]=c[1]+w|0,c[2]=c[2]+_|0,c[3]=c[3]+r|0,c[4]=c[4]+i|0,c[5]=c[5]+y|0,c[6]=c[6]+p|0,c[7]=c[7]+b|0},_doFinalize:function(){var o=this._data,f=o.words,c=this._nDataBytes*8,v=o.sigBytes*8;return f[v>>>5]|=128<<24-v%32,f[(v+64>>>9<<4)+14]=e.floor(c/4294967296),f[(v+64>>>9<<4)+15]=c,o.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var o=d.clone.call(this);return o._hash=this._hash.clone(),o}});t.SHA256=d._createHelper(l),t.HmacSHA256=d._createHmacHelper(l)}(Math),n.SHA256})});var ye=S((Z,ge)=>{F();(function(n,e){typeof Z=="object"?ge.exports=Z=e(Y()):typeof define=="function"&&define.amd?define(["./core"],e):e(n.CryptoJS)})(Z,function(n){return function(){var e=n,t=e.lib,s=t.WordArray,u=e.enc,d=u.Base64={stringify:function(C){var a=C.words,g=C.sigBytes,l=this._map;C.clamp();for(var o=[],f=0;f<g;f+=3)for(var c=a[f>>>2]>>>24-f%4*8&255,v=a[f+1>>>2]>>>24-(f+1)%4*8&255,w=a[f+2>>>2]>>>24-(f+2)%4*8&255,_=c<<16|v<<8|w,r=0;r<4&&f+r*.75<g;r++)o.push(l.charAt(_>>>6*(3-r)&63));var i=l.charAt(64);if(i)for(;o.length%4;)o.push(i);return o.join("")},parse:function(C){var a=C.length,g=this._map,l=this._reverseMap;if(!l){l=this._reverseMap=[];for(var o=0;o<g.length;o++)l[g.charCodeAt(o)]=o}var f=g.charAt(64);if(f){var c=C.indexOf(f);c!==-1&&(a=c)}return h(C,a,l)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function h(C,a,g){for(var l=[],o=0,f=0;f<a;f++)if(f%4){var c=g[C.charCodeAt(f-1)]<<f%4*2,v=g[C.charCodeAt(f)]>>>6-f%4*2,w=c|v;l[o>>>2]|=w<<24-o%4*8,o++}return s.create(l,o)}}(),n.enc.Base64})});F();F();F();var me=j(fe());F();var J=j(ue(),1);F();var R=null;typeof WebSocket<"u"?R=WebSocket:typeof MozWebSocket<"u"?R=MozWebSocket:typeof globalThis<"u"?R=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?R=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(R=self.WebSocket||self.MozWebSocket);var X=R;var ee=j(Ce()),te=j(ye());function Ve(n,e,t){let s=te.default.stringify((0,ee.default)(t+n));return te.default.stringify((0,ee.default)(s+e))}var D=(0,me.default)("obs-websocket-js"),q=class extends Error{constructor(n,e){super(e),this.code=n}},we=class K extends J.default{static requestCounter=1;static generateMessageId(){return String(K.requestCounter++)}_identified=!1;internalListeners=new J.default;socket;get identified(){return this._identified}async connect(e="ws://127.0.0.1:4455",t,s={}){this.socket&&await this.disconnect();try{let u=this.internalEventPromise("ConnectionClosed"),d=this.internalEventPromise("ConnectionError");return await Promise.race([(async()=>{let h=await this.createConnection(e);return this.emit("Hello",h),this.identify(h,t,s)})(),new Promise((h,C)=>{d.then(a=>{a.message&&C(a)}),u.then(a=>{C(a)})})])}catch(u){throw await this.disconnect(),u}}async disconnect(){if(!this.socket||this.socket.readyState===X.CLOSED)return;let e=this.internalEventPromise("ConnectionClosed");this.socket.close(),await e}async reidentify(e){let t=this.internalEventPromise("op:2");return await this.message(3,e),t}async call(e,t){let s=K.generateMessageId(),u=this.internalEventPromise(`res:${s}`);await this.message(6,{requestId:s,requestType:e,requestData:t});let{requestStatus:d,responseData:h}=await u;if(!d.result)throw new q(d.code,d.comment);return h}async callBatch(e,t={}){let s=K.generateMessageId(),u=this.internalEventPromise(`res:${s}`);await this.message(8,{requestId:s,requests:e,...t});let{results:d}=await u;return d}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(e){var t;let s=this.internalEventPromise("ConnectionOpened"),u=this.internalEventPromise("op:0");this.socket=new X(e,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await s;let d=(t=this.socket)==null?void 0:t.protocol;if(!d)throw new q(-1,"Server sent no subprotocol");if(d!==this.protocol)throw new q(-1,"Server sent an invalid subprotocol");return u}async identify({authentication:e,rpcVersion:t,...s},u,d={}){let h={rpcVersion:t,...d};e&&u&&(h.authentication=Ve(e.salt,e.challenge,u));let C=this.internalEventPromise("op:2");await this.message(1,h);let a=await C;return this._identified=!0,this.emit("Identified",a),{rpcVersion:t,...s,...a}}async message(e,t){if(!this.socket)throw new Error("Not connected");if(!this.identified&&e!==1)throw new Error("Socket not identified");let s=await this.encodeMessage({op:e,d:t});this.socket.send(s)}async internalEventPromise(e){return new Promise(t=>{this.internalListeners.once(e,t)})}onOpen(e){D("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",e)}async onMessage(e){try{let{op:t,d:s}=await this.decodeMessage(e.data);if(D("socket.message: %d %j",t,s),t===void 0||s===void 0)return;switch(t){case 5:{let{eventType:u,eventData:d}=s;this.emit(u,d);return}case 7:case 9:{let{requestId:u}=s;this.internalListeners.emit(`res:${u}`,s);return}default:this.internalListeners.emit(`op:${t}`,s)}}catch(t){D("error handling message: %o",t)}}onError(e){D("socket.error: %o",e);let t=new q(-1,e.message);this.emit("ConnectionError",t),this.internalListeners.emit("ConnectionError",t)}onClose(e){D("socket.close: %s (%d)",e.reason,e.code);let t=new q(e.code,e.reason);this.emit("ConnectionClosed",t),this.internalListeners.emit("ConnectionClosed",t),this.cleanup()}};typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});var Fe=class extends we{protocol="obswebsocket.json";async encodeMessage(n){return JSON.stringify(n)}async decodeMessage(n){return JSON.parse(n)}};var kt=new Fe;export{kt as default};
//# sourceMappingURL=websocket.js.map
